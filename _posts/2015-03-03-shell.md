---
layout: post
title: "Shell"
category: Memo
tags: "shell"
---

> 这里记录我容易忘记的shell代码片段

<!-- more -->

### 18. 如果遇到基础问题

```sh
# 如果是基础问题，一定要自己搞定 － 一个同事的名言，感谢。
```

### 17. MacOS sed issue
When run sed command on MaxOS, error will emit:

```sh
localhost:duck zdd$ sed -i "s/old/new/g" a
sed: 1: "a": command a expects \ followed by text
```

是因为MacOS下的sed命令需要一个backup文件的参数，用来保存你原始文件，避免错误的修改之后无法恢复。只要指定这个文件名就好了。

```sh
$ sed -i .bk "s/old/new/g" a # 保存原始文件为a.bk
$ sed -i "" "s/old/new/g" a # 不保存备份
```

### 16. 设置最大可打开的文件数

```sh
$ ulimit -n 1024 # mac
```

### 15. shell 回显调试
比起bash -v, -x 更适合调试了

```sh
#!/bin/sh -x
# 在变量替换之后、执行命令之前，显示脚本的每一行
```

### 14. 添加文件到另一文件的指定行

```sh
$ sed -i '2 r a.txt' b.txt
# 插入a.txt的内容到b.txt的第二行
```

### 13. aptitude
相比apt-get, aptitude会自动处理依赖 

```sh
aptitude update
更新可用的包列表

aptitude upgrade
升级可用的包

aptitude dist-upgrade
将系统升级到新的发行版

aptitude install pkgname
安装包

aptitude remove pkgname
删除包

aptitude purge pkgname
删除包及其配置文件

aptitude search string
搜索包

aptitude show pkgname
显示包的详细信息

aptitude clean
删除下载的包文件

aptitude autoclean
仅删除过期的包文件
```

### 12. apt-get install
当在ubuntu上安装某些包时，会提示：
When use apt-get install, if show depends ...
只使用

```sh
$ apt-get –f install
```

不要加包名在后面


### 11. shell快捷键
```sh
Shortcut	Description
CTRL-A	Move cursor to beginning of line
CTRL-E	Move cursor to end of line
CTRL-R	Search bash history
CTRL-W	Cut the last word
CTRL-U	Cut everything before the cursor
CTRL-K	Cut everything after the cursor
CTRL-Y	Paste the last thing to be cut
CTRL-_	Undo
```

### 10. 系统信息查询
```sh
# ps: 用了这么久的linux,居然没看过系统信息，也是醉了。
$ cat /proc/meminfo
$ cat /proc/cpuinfo
$ /proc/里有一切...
$ df -h
$ lscpu lsusb lshw
$ ...ls可以看一切

# 话说，我每次遇到命令的用法都是谷歌的,以后请优先使用man
$ man man
```

### 9. 大小写转换
```sh
$ LowChar=`echo $line | tr 'A-Z' 'a-z'`
$ UpChar=`echo $line | tr 'a-z' 'A-Z'`
```

### 8. 删除匹配行
```sh
$ sed -i '/#$/d' filename
```

### 7. find 常用命令
```sh
# 查找并删除
$ find . –name “*.xml” –exec rm {} \;
```

### 6. 远程登陆简化脚本
```sh
#!/usr/bin/expect
set timeout 30
spawn ssh zdd@github.com
expect "*assword:"
send "password\r"
interact 
```

### 5. Shell 读取指定列
```sh
$ll | grep xxx | awk ‘{print $9}’
# 或
$ll | grep xxx | cut –c 55-
```

### 4. Shell 读两个文件
```sh
#!/bin/sh 

exec 3<$1 
exec 4<$2 
while read line1 <&3 && read line2 <&4 
do 
    echo "$line1" 
    echo "$line2" 
done 
```

### 3. Shell Usage提示
```sh
if [ $# -lt 2 ]; then 
    echo "Usage: xx.sh argv1 argv2" 
    echo "\tmake sure xxx" 
    exit 1 
fi 
```

### 2. Shell 多行输出

```sh
cat << INFO
some info
some info
INFO
```
### 1. Install deb 
```sh
sudo dpkg -i *.deb
```
